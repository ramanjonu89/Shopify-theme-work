{%- assign img_url = image | img_url: '1x1' | replace: '_1x1.', '_{width}x.' -%}

<div class="flexible-image" style="--ar: {{ 1 | divided_by: image.aspect_ratio | times: 100 }}%">
  <img
    class="flexible-image__img lazyload {% if preload %}lazypreload{% endif %}"
    src="{{ image | img_url: '300x300' }}"
    data-src="{{ img_url }}"
    data-widths="[180, 360, 540, 720, 900, 1080, 1296, 1512, 1728, 2048]"
    data-aspectratio="{{ image.aspect_ratio }}"
    data-sizes="auto"
    alt="{{ image.alt | escape }}"
  >
</div>